;;; -*-emacs-lisp-*-
;;; $Id$

;;; ニュースに流れていたソースでラップ。
;;; Wrapper to make .emacs self-compiling.
;;; (To recompile .emacs interactively, just reload it.)
;;; Author: Bill Brodie <wbrodie@panix.com>   Last Rev: Fri Apr 7 10:19 1995
;;; Changed by Kazushi Jam Marukawa <jam@pobox.com>

(defvar init-top-level t)
(defvar init-complete nil)

(if init-top-level
    (let ((init-top-level nil)
	  (elc-filename
	   (cond ((string< emacs-version "19") "~/.emacs18.elc")
		 ((string< emacs-version "20") "~/.emacs19.elc")
		 ((string< emacs-version "21") "~/.emacs20.elc")
		 ((string< emacs-version "22") "~/.emacs21.elc")
		 ((string< emacs-version "23") "~/.emacs22.elc")
		 (t "~/.emacsxx.elc"))))
      (if (file-newer-than-file-p "~/.emacs" elc-filename)
          (progn
            (or init-complete (load "~/.emacs" nil t t))
            (byte-compile-file "~/.emacs")
	    (if (file-exists-p "~/.emacsc")
		(rename-file "~/.emacsc" elc-filename t))
	    (if (file-exists-p "~/.emacs.elc")
		(rename-file "~/.emacs.elc" elc-filename t)))
        (or init-complete (load elc-filename nil t t))))
(progn

;;;     <Your current .emacs file here, unchanged>

;;;;INSERT_DOT_EMACS
;;
;; 日本語環境で UTF-8 をメインにする設定
;;

;; 日本語環境
(set-language-environment 'Japanese)

;; Windows系はロケールに従う
(unless (or (eq system-type 'windows-nt)
	    (eq system-type 'cygwin))

  ;; UTF-8を設定
  (prefer-coding-system 'utf-8)

  ;; locale に無関係に UTF8 を設定
  (setq default-file-name-coding-system 'utf-8)
  
  ;; プロセスの環境変数設定
  (setenv "LANG" "ja_JP.UTF-8"))

;; GNU/Linux で egg-anthy を使う設定
(if (eq system-type 'gnu/linux)
    (set-language-info "Japanese" 'input-method "japanese-egg-anthy"))
;;
;; 標準設定
;;

;; 操作/表示の細かい設定
(setq inhibit-startup-message nil)	;; オープニングは大事
(setq next-line-add-newlines nil)	;; カーソルで新しい行を作らない
(setq line-number-mode t)		;; modeline に行番号表示
(setq column-number-mode t)		;; modeline にカラム番号表示
(setq scroll-step 1)			;; スクロールは1行づつ
(setq truncate-lines nil)		;; 継続行は使わない
(setq transient-mark-mode nil)		;; Region に色付けない

;; Xの設定で鳴らさないようにするので、、。
;; ~/.xsession -->
;;   xset b off
;;(setq visible-bell t)

;; 端末ではメニューバーを消す
(if (and (not window-system) (fboundp 'menu-bar-mode))
    (menu-bar-mode 0))

;; scroll-bar は右側
(if (fboundp 'set-scroll-bar-mode)
    (set-scroll-bar-mode 'right))

;; tool-bar は消す
(if (fboundp 'tool-bar-mode)
    (tool-bar-mode -1))

;; 時計の表示
(setq display-time-day-and-date nil)
(display-time)

;; ヒストリ数を設定する。
;;(setq comint-input-ring-size 200)

;; Emacs内部端末で Password を隠しまほう
(add-hook 'comint-output-filter-functions
	  'comint-watch-for-password-prompt)

;; EDITOR=emacsclientで emacs で開く
;;(server-start)

;; Windows系でCygwinのBashを使う
(when (and (or (eq system-type 'windows-nt)
	       (eq system-type 'cygwin))
	   (executable-find "bash"))
  (setq shell-file-name "bash")
  (setenv "SHELL" shell-file-name)
  (setenv "CYGWIN" "binmode nontsec tty")

  (add-hook 'comint-output-filter-functions
	    'comint-strip-ctrl-m)
  )
;;
;; 色を付ける共通設定
;;

(global-font-lock-mode t)

;; jit-lock-mode を使う
(setq font-lock-support-mode 'jit-lock-mode)

(defface moi-string-face
  '((((class color) (background light)) (:foreground "Brown"))
    (((class color) (background dark)) (:foreground "Salmon"))
    (t (:italic t)))
  nil
  )
(setq font-lock-string-face 'moi-string-face)


;;; Matches IF from top of file
))
